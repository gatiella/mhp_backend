{% extends "rest_framework/base.html" %}
{% load rest_framework %}

{% block title %}
    {% if name %}{{ name }} - {% endif %}Mental Health Partner API
{% endblock %}

{% block breadcrumbs %}
    <ul class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="{% url 'api-root' %}">API Root</a></li>
        {% if name %}
            <li class="active">{{ name }}</li>
        {% endif %}
    </ul>
{% endblock %}

{% block content %}
    <div class="content-main">
        <div class="page-header">
            <h1>
                {% if name %}{{ name }}{% else %}API Endpoint{% endif %}
                {% if allowed_methods %}
                    <div style="margin-top: 0.5rem;">
                        {% for method in allowed_methods %}
                            <span class="method-badge method-{{ method|lower }}">{{ method }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
            </h1>
        </div>

        {% if description %}
            <div class="response-info">
                <p>{{ description }}</p>
            </div>
        {% endif %}

        <div class="response-info">
            <strong>Endpoint:</strong> {{ request.build_absolute_uri }}
        </div>

        {% if response_headers %}
            <div class="response-info">
                <h3>Response Headers</h3>
                {% for key, value in response_headers.items %}
                    <div><strong>{{ key }}:</strong> {{ value }}</div>
                {% endfor %}
            </div>
        {% endif %}

        {% if content %}
            <div class="response-info">
                <h3>Response</h3>
                {% if status_code %}
                    <div style="margin-bottom: 1rem;">
                        <span class="label label-{% if status_code == 200 or status_code == 201 %}success{% elif status_code >= 400 %}danger{% else %}info{% endif %}">
                            {{ status_code }} {% if status_text %}{{ status_text }}{% endif %}
                        </span>
                    </div>
                {% endif %}
                <pre>{{ content|safe }}</pre>
            </div>
        {% endif %}

        {% if display_edit_forms %}
            <div class="well">
                <form action="{{ request.get_full_path }}" method="POST" class="form-horizontal">
                    {% csrf_token %}
                    <fieldset>
                        <legend>{% if request.method == 'PUT' %}Update{% else %}Create{% endif %}</legend>
                        {% render_form serializer %}
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="glyphicon glyphicon-ok"></i> 
                                {% if request.method == 'PUT' %}PUT{% else %}POST{% endif %}
                            </button>
                        </div>
                    </fieldset>
                </form>
            </div>
        {% endif %}

        {% if raw_data_post_form %}
            <div class="well">
                <form action="{{ request.get_full_path }}" method="POST" class="form-horizontal">
                    {% csrf_token %}
                    <fieldset>
                        <legend>Raw Data</legend>
                        <div class="form-group">
                            <div class="col-sm-12">
                                <textarea name="raw_data" class="form-control" rows="10" placeholder="Enter raw JSON data">{{ raw_data }}</textarea>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="glyphicon glyphicon-ok"></i> POST
                            </button>
                        </div>
                    </fieldset>
                </form>
            </div>
        {% endif %}

        {% if filter_form %}
            <div class="well">
                <form class="form-inline" method="GET">
                    <fieldset>
                        <legend>Filters</legend>
                        {% for field in filter_form %}
                            <div class="form-group">
                                {{ field.label_tag }}
                                {{ field }}
                            </div>
                        {% endfor %}
                        <button type="submit" class="btn btn-default">
                            <i class="glyphicon glyphicon-search"></i> Filter
                        </button>
                    </fieldset>
                </form>
            </div>
        {% endif %}
    </div>
{% endblock %}